import{d as e,N as t,a as o,u as a,b as s,l,r as i,o as r,c as n,w as g,e as h,f as d,g as c,h as u,i as m,B as p,R as _,j as w,k as P,m as k,t as F,n as b,p as S,q as v,s as f,v as M,x as N,y as I,z as D,A as y,C,D as T,S as x,E as H,F as $,G as W,H as L,I as z,J as A,K as B,L as R,M as U,O,P as X,Q as E,T as j,U as G,V as Y,W as V,X as K,Y as q,Z as J,_ as Q,$ as Z,a0 as ee,a1 as te}from"./vendor.d6b6e896.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var oe=(e,t)=>{const o=e.__vccOpts||e;for(const[a,s]of t)o[a]=s;return o};const ae=e({name:"Home",components:{NMessageProvider:t,NConfigProvider:o},setup(){const{cookies:e}=a();return{cookies:e,darkTheme:s,lightTheme:l}},data:()=>({selectTemplate:"",isAuthenticated:!1}),created(){this.$store.dispatch("syncSeverStatusDataAction"),this.selectTemplate=this.getDefaultTemplate},beforeMount(){null!=this.$store.state.server_status.ServerName&&(document.title=this.$store.state.server_status.ServerName)},methods:{goToDashboard(){this.isAuthenticated?this.$router.push("/dashboard"):this.$router.push("/login")},OnSetTemplate(e){localStorage.setItem("nowTemplate",e),this.selectTemplate=e},getNumber:function(e){this.page=e,console.log(e)}},computed:{username(){return this.$route.params.username},book(){return this.$store.state.book},setting(){return this.$store.state.setting},getDefaultTemplate:function(){var e=localStorage.getItem("nowTemplate");return null!==e?e:"scroll"}}}),se={class:"app"};var le=oe(ae,[["render",function(e,t,o,a,s,l){const c=i("router-view"),u=i("n-message-provider"),m=i("n-config-provider");return r(),n(m,{theme:e.lightTheme},{default:g((()=>[h("div",se,[d(u,null,{default:g((()=>[d(c)])),_:1})])])),_:1},8,["theme"])}]]);const ie={};const re=e({name:"Header",props:["setDownLoadLink","bookName","showReturnIcon"],components:{NSpace:c,NIcon:u,NEllipsis:m,BookOutline:p,ReturnUpBack:_},setup(){const{cookies:e}=a();return{cookies:e}},data:()=>({someflag:""}),methods:{onClickReturnIcon(){this.$router.back()},onClickToTop(){this.$router.push("/")}}}),ne={class:"header"},ge={key:0,class:"text-lg"},he={class:"text-lg"},de=["href"];var ce=oe(re,[["render",function(e,t,o,a,s,l){const c=i("return-up-back"),u=i("n-icon"),m=i("book-outline"),p=i("n-ellipsis"),_=i("n-space");return r(),w("header",ne,[e.showReturnIcon?(r(),n(u,{key:0,size:"40",onClick:t[0]||(t[0]=t=>e.onClickReturnIcon())},{default:g((()=>[d(c)])),_:1})):P("",!0),e.showReturnIcon?P("",!0):(r(),n(u,{key:1,onClick:t[1]||(t[1]=t=>e.onClickToTop()),size:"40"},{default:g((()=>[d(m)])),_:1})),d(_,null,{default:g((()=>[d(p,{style:{"max-width":"60vw"}},{default:g((()=>[e.setDownLoadLink?P("",!0):(r(),w("span",ge,F(e.bookName),1)),h("span",he,[this.setDownLoadLink?(r(),w("a",{key:0,href:"raw/"+e.bookName},F(e.bookName),9,de)):P("",!0)])])),_:1})])),_:1}),k(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-ad4b2da8"]]);const ue=e({name:"Drawer",props:["book","initDrawerActive","initDrawerPlacement","ReaderMode","sketching"],emits:["setRM","saveConfig","startSketch","stopSketch","closeDrawer"],components:{NDrawer:b,NDrawerContent:S,NSpace:c,NDivider:v,NButton:f,NSelect:M,NPopconfirm:N},setup(){const{cookies:e}=a();return{handlePositiveClick(){localStorage.clear(),location.reload()},handleNegativeClick(){},cookies:e,languageOptions:[{label:"English",value:"en"},{label:"日本語",value:"ja"},{label:"中文",value:"zh"}]}},data:()=>({someflag:"",readModeLocal:""}),beforeMount(){var e=this.cookies.get("userLanguageSetting");e&&(this.$i18n.locale=e),this.readModeLocal=this.readMode},computed:{drawerActive(){return this.initDrawerActive},drawerPlacement(){return this.initDrawerPlacement}},methods:{OnChangeLanguage(e){this.cookies.set("userLanguageSetting",e)},saveConfigToCookie(e){0==e&&(this.$emit("closeDrawer"),this.$emit("saveConfig"))},startSketchMode(){this.$emit("startSketch")},stopSketchMode(){this.$emit("stopSketch")},onChangeTemplate(){"scroll"===this.readModeLocal&&this.$emit("setRM","scroll"),"flip"===this.readModeLocal&&this.$emit("setRM","flip"),"sketch"===this.readModeLocal&&this.$emit("setRM","sketch")}}}),me=I("切换为翻页阅读"),pe=I("切换为滚动阅读");var _e=oe(ue,[["render",function(e,t,o,a,s,l){const c=i("n-button"),u=i("n-space"),m=i("n-divider"),p=i("n-popconfirm"),_=i("n-select"),w=i("n-drawer-content"),b=i("n-drawer");return r(),n(b,{show:e.drawerActive,"onUpdate:show":e.saveConfigToCookie,height:275,width:251,placement:e.drawerPlacement},{default:g((()=>[d(w,{closable:""},{header:g((()=>[h("span",null,F(e.$t("ReaderSettings")),1)])),footer:g((()=>[d(_,{placeholder:"select language",value:this.$i18n.locale,"onUpdate:value":[t[0]||(t[0]=e=>this.$i18n.locale=e),e.OnChangeLanguage],options:this.languageOptions},null,8,["value","options","onUpdate:value"]),0==this.sketching?(r(),n(c,{key:0,onClick:e.startSketchMode},{default:g((()=>[I(F(e.$t("startSketchMode")),1)])),_:1},8,["onClick"])):P("",!0),1==this.sketching?(r(),n(c,{key:1,onClick:e.stopSketchMode},{default:g((()=>[I(F(e.$t("stopSketchMode")),1)])),_:1},8,["onClick"])):P("",!0)])),default:g((()=>[d(u,null,{default:g((()=>[d(c,{onClick:e.toFlipMode},{default:g((()=>[me])),_:1},8,["onClick"]),d(c,{onClick:e.toScrollMode},{default:g((()=>[pe])),_:1},8,["onClick"])])),_:1}),d(m),k(e.$slots,"default"),d(m),d(p,{onPositiveClick:e.handlePositiveClick,onNegativeClick:e.handleNegativeClick},{trigger:g((()=>[d(c,null,{default:g((()=>[I(F(e.$t("reset_all_settings")),1)])),_:1})])),default:g((()=>[I(" "+F(e.$t("do_you_reset_all_settings")),1)])),_:1},8,["onPositiveClick","onNegativeClick"])])),_:3})])),_:3},8,["show","onUpdate:show","placement"])}]]);const we=e({name:"ScrollMode",props:["nowTemplate"],emits:["setTemplate"],components:{Header:ce,Drawer:_e,NButton:f,NBackTop:D,NSpace:c,NSlider:y,NSwitch:C,NIcon:u,NInputNumber:T,SettingsOutline:x,NDivider:v},setup(){const{cookies:e}=a(),t=H({color:"#f6f7eb",colorHeader:"#d1c9c1"}),o=H({resize_width:-1,resize_height:-1,do_auto_resize:!1,resize_max_width:800,resize_max_height:-1,do_auto_crop:!1,auto_crop:1,gray:!1});return{cookies:e,model:t,imageParameters:o,imageParametersString:e=>{if("api/getfile?"==e.substr(0,12)){var t=document.location.toString().split("/"),a=t[0]+"//"+t[2]+"/"+e,s=o.resize_width>0?"&resize_width="+o.resize_width:"",l=o.resize_height>0?"&resize_height="+o.resize_height:"",i=o.gray?"&gray=true":"";return a+s+l+(o.do_auto_resize?"&resize_max_width="+o.resize_max_width:"")+(o.resize_max_height>0?"&resize_max_height="+o.resize_max_height:"")+(o.do_auto_crop?"&auto_crop="+o.auto_crop:"")+i}return e},railStyle:({focused:e,checked:t})=>{const o={};return t?(o.background="#d03050",e&&(o.boxShadow="0 0 0 2px #d0305040")):(o.background="#2080f0",e&&(o.boxShadow="0 0 0 2px #2080f040")),o},marks:{30:"25%",50:"50%",75:"75%",95:"95%"}}},data:()=>({book:{name:"loading",all_page_num:2,pages:[{height:500,width:449,url:"/images/loading.jpg"},{height:500,width:449,url:"/images/loading.jpg"}]},drawerActive:!1,drawerPlacement:"right",debugModeFlag:!0,showHeaderFlag:!0,showPageNumFlag_ScrollMode:!1,showBackTopFlag:!1,scrollDownFlag:!1,scrollTopSave:0,syncScrollFlag:!1,clickX:0,clickY:0,isLandscapeMode:!0,isPortraitMode:!1,imageMaxWidth:10,aspectRatio:1.2,imageWidth_usePercentFlag:!1,singlePageWidth_Percent:50,doublePageWidth_Percent:95,singlePageWidth_PX:720,doublePageWidth_PX:1080,clientWidth:0,clientHeight:0}),created(){if($.get("/getbook?id="+this.$route.params.id).then((e=>this.book=e.data)).finally((()=>{document.title=this.book.name,console.log("成功获取书籍数据,书籍ID："+this.$route.params.id)})),this.$watch((()=>this.$route.params.id),(e=>{e&&$.get("/getbook?id="+this.$route.params.id).then((e=>this.book=e.data)).finally(console.log("路由参数改变,书籍ID："+e))})),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onResize),this.imageMaxWidth=window.innerWidth,"true"===localStorage.getItem("showHeaderFlag")?this.showHeaderFlag=!0:"false"===localStorage.getItem("showHeaderFlag")&&(this.showHeaderFlag=!1),"true"===localStorage.getItem("showPageNumFlag_ScrollMode")?this.showPageNumFlag_ScrollMode=!0:"false"===localStorage.getItem("showPageNumFlag_ScrollMode")&&(this.showPageNumFlag_ScrollMode=!1),"true"===localStorage.getItem("ImageParameters_Gray")?this.imageParameters.gray=!0:"false"===localStorage.getItem("ImageParameters_Gray")&&(this.imageParameters.gray=!1),"true"===localStorage.getItem("ImageParameters_DoAutoResize")?this.imageParameters.do_auto_resize=!0:"false"===localStorage.getItem("ImageParameters_DoAutoResize")&&(this.imageParameters.do_auto_resize=!1),null!=localStorage.getItem("ImageParametersResizeMaxWidth")){let e=Number(localStorage.getItem("ImageParametersResizeMaxWidth"));isNaN(e)||(this.imageParameters.resize_max_width=e)}if("true"===localStorage.getItem("ImageParameters_DoAutoCrop")?this.imageParameters.do_auto_crop=!0:"false"===localStorage.getItem("ImageParameters_DoAutoCrop")&&(this.imageParameters.do_auto_crop=!1),null!=localStorage.getItem("ImageParameters_DoAutoCrop")){let e=Number(localStorage.getItem("ImageParameters_DoAutoCrop"));isNaN(e)||(this.imageParameters.auto_crop=e)}if("true"===localStorage.getItem("imageWidth_usePercentFlag")?this.imageWidth_usePercentFlag=!0:"false"===localStorage.getItem("imageWidth_usePercentFlag")&&(this.imageWidth_usePercentFlag=!1),null!=localStorage.getItem("singlePageWidth_Percent")){let e=Number(localStorage.getItem("singlePageWidth_Percent"));isNaN(e)||(this.singlePageWidth_Percent=e)}if(null!=localStorage.getItem("doublePageWidth_Percent")){let e=Number(localStorage.getItem("doublePageWidth_Percent"));isNaN(e)||(this.doublePageWidth_Percent=e)}if(null!=localStorage.getItem("singlePageWidth_PX")){let e=Number(localStorage.getItem("singlePageWidth_PX"));isNaN(e)||(this.singlePageWidth_PX=e)}if(null!=localStorage.getItem("doublePageWidth_PX")){let e=Number(localStorage.getItem("doublePageWidth_PX"));isNaN(e)||(this.doublePageWidth_PX=e)}null!=localStorage.getItem("ScrollModeDefaultColor")&&(this.model.color=localStorage.getItem("ScrollModeDefaultColor"),this.onBackgroundColorChange(this.model.color))},beforeMount(){},onMounted(){this.isLandscapeMode=this.inLandscapeModeCheck(),this.isPortraitMode=!this.inLandscapeModeCheck(),this.$nextTick((function(){}))},beforeUnmount(){window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize)},methods:{needDownloadLink(){return"dir"!=this.book.book_type},drawerActivate(e){this.drawerActive=!0,this.drawerPlacement=e},drawerDeactivate(){this.drawerActive=!1},startSketchMode(){this.$emit("setTemplate","sketch")},OnSetTemplate(e){this.$emit("setTemplate",e)},onBackgroundColorChange(e){let t=Number("0x"+e.substr(1,2)),o=Number("0x"+e.substr(3,2)),a=Number("0x"+e.substr(5,2)),s=t<215?t-40:t+parseInt((255-t)/2),l=o<225?o-30:o+parseInt((255-o)/2),i=a<213?a-42:a+parseInt((255-a)/2);t<50&&(s=t+120),o<50&&(l=o+90),a<50&&(i=a+126),this.model.colorHeader="#"+s.toString(16)+l.toString(16)+i.toString(16)},saveConfigToLocalStorage(){localStorage.setItem("showHeaderFlag",this.showHeaderFlag),localStorage.setItem("showPageNumFlag_ScrollMode",this.showPageNumFlag_ScrollMode),localStorage.setItem("imageWidth_usePercentFlag",this.imageWidth_usePercentFlag),localStorage.setItem("singlePageWidth_Percent",this.singlePageWidth_Percent),localStorage.setItem("doublePageWidth_Percent",this.doublePageWidth_Percent),localStorage.setItem("singlePageWidth_PX",this.singlePageWidth_PX),localStorage.setItem("doublePageWidth_PX",this.doublePageWidth_PX),localStorage.setItem("ScrollModeDefaultColor",this.model.color),localStorage.setItem("ImageParameters_DoAutoCrop",this.imageParameters.auto_crop),localStorage.setItem("ImageParametersResizeMaxWidth",this.imageParameters.resize_max_width)},setShowHeaderChange(e){this.showHeaderFlag=e,localStorage.setItem("showHeaderFlag",e),console.log("成功保存设置: showHeaderFlag="+localStorage.getItem("showHeaderFlag"))},setShowPageNumChange(e){this.showPageNumFlag_ScrollMode=e,localStorage.setItem("showPageNumFlag_ScrollMode",e),console.log("成功保存设置: showPageNumFlag_ScrollMode="+localStorage.getItem("showPageNumFlag_ScrollMode"))},setImageParameters_Gray(e){this.imageParameters.gray=e,localStorage.setItem("ImageParameters_Gray",e),console.log("成功保存设置: ImageParameters_Gray="+localStorage.getItem("ImageParameters_Gray"))},setImageParameters_DoAutoResize(e){this.imageParameters.do_auto_resize=e,localStorage.setItem("ImageParameters_DoAutoResize",e),console.log("成功保存设置: ImageParameters_DoAutoResize="+localStorage.getItem("ImageParameters_DoAutoResize"))},setImageParameters_DoAutoCrop(e){this.imageParameters.do_auto_crop=e,localStorage.setItem("ImageParameters_DoAutoCrop",this.imageParameters.do_auto_crop),console.log("成功保存设置: ImageParameters_DoAutoCrop="+localStorage.getItem("ImageParameters_DoAutoCrop"))},setImageWidthUsePercentFlag(e){console.log("value:"+e),this.imageWidth_usePercentFlag=e,localStorage.setItem("imageWidth_usePercentFlag",e),console.log("成功保存设置: imageWidth_usePercentFlag="+this.imageWidth_usePercentFlag)},onResize(){this.imageMaxWidth=window.innerWidth,this.clientWidth=document.documentElement.clientWidth,this.clientHeight=document.documentElement.clientHeight,this.aspectRatio=this.clientWidth/this.clientHeight,this.aspectRatio>1?(this.isLandscapeMode=!0,this.isPortraitMode=!1):(this.isLandscapeMode=!1,this.isPortraitMode=!0)},onScroll(){let e=document.documentElement.scrollTop||document.body.scrollTop;this.scrollDownFlag=e>this.scrollTopSave;let t=this.scrollTopSave-e;this.scrollTopSave=e,t<-5&&t>5&&(this.showBackTopFlag=e>400&&!this.scrollDownFlag)},onMouseClick(e){this.clickX=e.x,this.clickY=e.y;let t=window.innerWidth,o=window.innerHeight,a=.4*t,s=.6*t,l=.4*o,i=.6*o;this.clickX>a&&this.clickX<s&&this.clickY>l&&this.clickY<i&&this.drawerActivate("right")},onMouseMove(e){this.clickX=e.x,this.clickY=e.y;let t=window.innerWidth,o=window.innerHeight,a=.4*t,s=.6*t,l=.4*o,i=.6*o;this.clickX>a&&this.clickX<s&&this.clickY>l&&this.clickY<i?e.currentTarget.style.cursor="url(/images/SettingsOutline.png), pointer":e.currentTarget.style.cursor=""},onMouseLeave(e){e.currentTarget.style.cursor=""},scrollToTop(e){let t=-window.scrollY/(e/15),o=setInterval((function(){0!==window.scrollY?window.scrollBy(0,t):clearInterval(o)}),15)},inLandscapeModeCheck(){return this.aspectRatio=window.innerWidth/window.innerHeight,this.aspectRatio>1}},computed:{sPWL(){return this.imageWidth_usePercentFlag?this.singlePageWidth_Percent+"%":this.singlePageWidth_PX+"px"},dPWL(){return this.imageWidth_usePercentFlag?this.doublePageWidth_Percent+"%":this.doublePageWidth_PX+"px"},sPWP(){return this.imageWidth_usePercentFlag?this.singlePageWidth_Percent+"%":this.singlePageWidth_PX+"px"},dPWP(){return this.imageWidth_usePercentFlag?this.doublePageWidth_Percent+"%":this.doublePageWidth_PX+"px"}}}),Pe=()=>{W((e=>({"789c2944":e.model.color,"00daf4f1":e.model.colorHeader,"2d8fbfac":e.sPWL,"2d88ee1b":e.dPWL,"2d8fbfb0":e.sPWP,"2d88ee1f":e.dPWP})))},ke=we.setup;we.setup=ke?(e,t)=>(Pe(),ke(e,t)):Pe;const Fe=we,be=e=>(B("data-v-4636b26e"),e=e(),R(),e),Se={id:"ScrollMode",class:"manga"},ve=["alt"],fe={key:0,class:"page_hint"},Me=I("%"),Ne=I("%"),Ie=I("px"),De=I("px"),ye=be((()=>h("p",null,null,-1))),Ce=be((()=>h("p",null,null,-1))),Te=I("px");var xe=oe(Fe,[["render",function(e,t,o,a,s,l){const h=i("settings-outline"),c=i("n-icon"),u=i("Header"),m=i("n-input-number"),p=i("n-slider"),_=i("n-space"),k=i("n-switch"),b=i("n-divider"),S=i("Drawer"),v=i("n-back-top"),f=i("n-button"),M=L("lazy");return r(),w("div",Se,[this.showHeaderFlag?(r(),n(u,{key:0,class:"footer",setDownLoadLink:this.needDownloadLink(),bookName:e.book.name,showReturnIcon:!0},{default:g((()=>[d(c,{size:"40",onClick:t[0]||(t[0]=t=>e.drawerActivate("right"))},{default:g((()=>[d(h)])),_:1})])),_:1},8,["setDownLoadLink","bookName"])):P("",!0),e.book?(r(!0),w(z,{key:1},A(e.book.pages,((o,a)=>(r(),w("div",{class:"main_manga",key:o.url,onClick:t[1]||(t[1]=t=>e.onMouseClick(t)),onMousemove:t[2]||(t[2]=(...t)=>e.onMouseMove&&e.onMouseMove(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.onMouseLeave&&e.onMouseLeave(...t))},[U((r(),w("img",{alt:a+1,key:a},null,8,ve)),[[M,this.imageParametersString(o.url)]]),e.showPageNumFlag_ScrollMode?(r(),w("div",fe,F(a+1)+"/"+F(e.book.all_page_num),1)):P("",!0)],32)))),128)):P("",!0),d(S,{initDrawerActive:this.drawerActive,initDrawerPlacement:this.drawerPlacement,onSaveConfig:this.saveConfigToLocalStorage,onStartSketch:this.startSketchMode,onCloseDrawer:this.drawerDeactivate,onSetT:this.OnSetTemplate,nowTemplate:this.nowTemplate},{default:g((()=>[d(_,{vertical:""},{default:g((()=>[this.imageWidth_usePercentFlag?(r(),n(m,{key:0,size:"small","show-button":!1,value:this.singlePageWidth_Percent,"onUpdate:value":t[4]||(t[4]=e=>this.singlePageWidth_Percent=e),max:100,min:10,"update-value-on-input":!1},{prefix:g((()=>[I(F(e.$t("singlePageWidth")),1)])),suffix:g((()=>[Me])),_:1},8,["value"])):P("",!0),this.imageWidth_usePercentFlag?(r(),n(p,{key:1,value:this.singlePageWidth_Percent,"onUpdate:value":t[5]||(t[5]=e=>this.singlePageWidth_Percent=e),step:1,max:100,min:10,"format-tooltip":e=>`${e}%`},null,8,["value","format-tooltip"])):P("",!0),this.imageWidth_usePercentFlag?(r(),n(m,{key:2,size:"small","show-button":!1,value:this.doublePageWidth_Percent,"onUpdate:value":t[6]||(t[6]=e=>this.doublePageWidth_Percent=e),max:100,min:10,"update-value-on-input":!1},{prefix:g((()=>[I(F(e.$t("doublePageWidth")),1)])),suffix:g((()=>[Ne])),_:1},8,["value"])):P("",!0),this.imageWidth_usePercentFlag?(r(),n(p,{key:3,value:this.doublePageWidth_Percent,"onUpdate:value":t[7]||(t[7]=e=>this.doublePageWidth_Percent=e),step:1,max:100,min:10,"format-tooltip":e=>`${e}%`},null,8,["value","format-tooltip"])):P("",!0),this.imageWidth_usePercentFlag?P("",!0):(r(),n(m,{key:4,size:"small","show-button":!1,value:this.singlePageWidth_PX,"onUpdate:value":t[8]||(t[8]=e=>this.singlePageWidth_PX=e),min:50,"update-value-on-input":!1},{prefix:g((()=>[I(F(e.$t("singlePageWidth")),1)])),suffix:g((()=>[Ie])),_:1},8,["value"])),this.imageWidth_usePercentFlag?P("",!0):(r(),n(p,{key:5,value:this.singlePageWidth_PX,"onUpdate:value":t[9]||(t[9]=e=>this.singlePageWidth_PX=e),step:10,max:1600,min:50,"format-tooltip":e=>`${e}px`},null,8,["value","format-tooltip"])),this.imageWidth_usePercentFlag?P("",!0):(r(),n(m,{key:6,size:"small","show-button":!1,value:this.doublePageWidth_PX,"onUpdate:value":t[10]||(t[10]=e=>this.doublePageWidth_PX=e),min:50,"update-value-on-input":!1},{prefix:g((()=>[I(F(e.$t("doublePageWidth")),1)])),suffix:g((()=>[De])),_:1},8,["value"])),this.imageWidth_usePercentFlag?P("",!0):(r(),n(p,{key:7,value:this.doublePageWidth_PX,"onUpdate:value":t[11]||(t[11]=e=>this.doublePageWidth_PX=e),step:10,max:1600,min:50,"format-tooltip":e=>`${e}px`},null,8,["value","format-tooltip"]))])),_:1}),ye,d(_,null,{default:g((()=>[d(k,{size:"large",value:this.imageWidth_usePercentFlag,"onUpdate:value":[t[12]||(t[12]=e=>this.imageWidth_usePercentFlag=e),this.setImageWidthUsePercentFlag],"rail-style":e.railStyle},{checked:g((()=>[I(F(e.$t("width_usePercent")),1)])),unchecked:g((()=>[I(F(e.$t("width_useFixedValue")),1)])),_:1},8,["value","rail-style","onUpdate:value"])])),_:1}),d(b),d(_,null,{default:g((()=>[d(k,{size:"large",value:this.showHeaderFlag,"onUpdate:value":[t[13]||(t[13]=e=>this.showHeaderFlag=e),e.setShowHeaderChange]},{checked:g((()=>[I(F(e.$t("showHeader")),1)])),unchecked:g((()=>[I(F(e.$t("showHeader")),1)])),_:1},8,["value","onUpdate:value"]),Ce])),_:1}),d(_,null,{default:g((()=>[d(k,{size:"large",value:this.showPageNumFlag_ScrollMode,"onUpdate:value":[t[14]||(t[14]=e=>this.showPageNumFlag_ScrollMode=e),e.setShowPageNumChange]},{checked:g((()=>[I(F(e.$t("showPageNum")),1)])),unchecked:g((()=>[I(F(e.$t("showPageNum")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(_,null,{default:g((()=>[d(k,{size:"large",value:this.imageParameters.gray,"onUpdate:value":[t[15]||(t[15]=e=>this.imageParameters.gray=e),e.setImageParameters_Gray]},{checked:g((()=>[I(F(e.$t("gray_image")),1)])),unchecked:g((()=>[I(F(e.$t("gray_image")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(b),d(_,null,{default:g((()=>[d(k,{size:"large",value:this.imageParameters.do_auto_crop,"onUpdate:value":[t[16]||(t[16]=e=>this.imageParameters.do_auto_crop=e),e.setImageParameters_DoAutoCrop]},{checked:g((()=>[I(F(e.$t("auto_crop")),1)])),unchecked:g((()=>[I(F(e.$t("auto_crop")),1)])),_:1},8,["value","onUpdate:value"]),this.imageParameters.do_auto_crop?(r(),n(m,{key:0,"show-button":!1,value:this.imageParameters.auto_crop,"onUpdate:value":t[17]||(t[17]=e=>this.imageParameters.auto_crop=e),max:10,min:0},{prefix:g((()=>[I(F(e.$t("energy_threshold")),1)])),_:1},8,["value"])):P("",!0)])),_:1}),d(_,null,{default:g((()=>[d(k,{size:"large","rail-style":e.railStyle,value:this.imageParameters.do_auto_resize,"onUpdate:value":[t[18]||(t[18]=e=>this.imageParameters.do_auto_resize=e),e.setImageParameters_DoAutoResize]},{checked:g((()=>[I(F(e.$t("image_width_limit")),1)])),unchecked:g((()=>[I(F(e.$t("raw_resolution")),1)])),_:1},8,["rail-style","value","onUpdate:value"]),this.imageParameters.do_auto_resize?(r(),n(m,{key:0,size:"small","show-button":!1,value:this.imageParameters.resize_max_width,"onUpdate:value":t[19]||(t[19]=e=>this.imageParameters.resize_max_width=e),min:100},{prefix:g((()=>[I(F(e.$t("max_width")),1)])),suffix:g((()=>[Te])),_:1},8,["value"])):P("",!0)])),_:1})])),_:1},8,["initDrawerActive","initDrawerPlacement","onSaveConfig","onStartSketch","onCloseDrawer","onSetT","nowTemplate"]),d(v,{show:e.showBackTopFlag,type:"info",color:"#8a2be2",right:20,bottom:20},null,8,["show"]),d(f,{onClick:t[20]||(t[20]=t=>{e.scrollToTop(90)}),size:"large",secondary:"",strong:""},{default:g((()=>[I(F(e.$t("back-to-top")),1)])),_:1})])}],["__scopeId","data-v-4636b26e"]]);const He=e({name:"FlipMode",props:[],emits:["childMark"],components:{Header:ce,Drawer:_e,NSpace:c,NSlider:y,NSwitch:C,NIcon:u,SettingsOutline:x,NColorPicker:O,NDivider:v,NInputNumber:T},setup(){const{cookies:e}=a(),t=H({color:"#f6f7eb",colorHeader:"#d1c9c1"});return{message:X(),model:t,cookies:e,railStyle:({focused:e,checked:t})=>{const o={};return t?(o.background="#18a058",e&&(o.boxShadow="0 0 0 2px #d0305040")):(o.background="#2080f0",e&&(o.boxShadow="0 0 0 2px #2080f040")),o},marks:{30:"30",60:"60",90:"90",120:"120"}}},data:()=>({book:{name:"loading",id:"abcde",all_page_num:2,pages:[{height:500,width:449,url:"/images/loading.jpg"},{height:500,width:449,url:"/images/loading.jpg"}]},drawerActive:!1,drawerPlacement:"right",debugModeFlag:!0,showHeaderFlag_FlipMode:!0,showFooterFlag_FlipMode:!0,rightToLeftFlag:!1,simpleDoublePageModeFlag:!1,autoDoublePageModeFlag:!1,saveNowPageNumFlag_FlipMode:!0,nowPageNum:1,sketchModeFlag:!1,showPageHintFlag_FlipMode:!1,sketchFlipSecond:30,sketchSecondCount:0,interval:null,nowPageIsDouble:!1,nextPageIsDouble:!1,nowAndNextPageIsSingleFlag:!0}),created(){if($.get("/getbook?id="+this.$route.params.id).then((e=>this.book=e.data)).finally(console.log("成功获取书籍数据,书籍ID："+this.$route.params.id)),this.$watch((()=>this.$route.params.id),(e=>{$.get("/getbook?id="+this.$route.params.id).then((e=>this.book=e.data)).finally(console.log("路由参数改变,书籍ID："+e))})),"true"==localStorage.getItem("debugModeFlag")?this.debugModeFlag=!0:"false"==localStorage.getItem("debugModeFlag")&&(this.debugModeFlag=!1),"true"==localStorage.getItem("showHeaderFlag_FlipMode")?this.showHeaderFlag_FlipMode=!0:"false"==localStorage.getItem("showHeaderFlag_FlipMode")&&(this.showHeaderFlag_FlipMode=!1),"true"==localStorage.getItem("showFooterFlag_FlipMode_FlipMode")?this.showFooterFlag_FlipMode=!0:"false"==localStorage.getItem("showFooterFlag_FlipMode_FlipMode")&&(this.showFooterFlag_FlipMode=!1),"true"==localStorage.getItem("showPageHintFlag_FlipMode")?this.showPageHintFlag_FlipMode=!0:"false"==localStorage.getItem("showPageHintFlag_FlipMode")&&(this.showPageHintFlag_FlipMode=!1),"true"==localStorage.getItem("rightToLeftFlag")?this.rightToLeftFlag=!0:"false"==localStorage.getItem("rightToLeftFlag")&&(this.rightToLeftFlag=!1),"true"==localStorage.getItem("simpleDoublePageModeFlag")?this.simpleDoublePageModeFlag=!0:"false"==localStorage.getItem("simpleDoublePageModeFlag")&&(this.simpleDoublePageModeFlag=!1),"true"==localStorage.getItem("autoDoublePageModeFlag")?this.autoDoublePageModeFlag=!0:"false"==localStorage.getItem("autoDoublePageModeFlag")&&(this.autoDoublePageModeFlag=!1),"true"==localStorage.getItem("saveNowPageNumFlag_FlipMode")?this.saveNowPageNumFlag_FlipMode=!0:"false"==localStorage.getItem("saveNowPageNumFlag_FlipMode")&&(this.saveNowPageNumFlag_FlipMode=!1),null!=localStorage.getItem("FlipModeDefaultColor")&&(this.model.color=localStorage.getItem("FlipModeDefaultColor"),this.onBackgroundColorChange(this.model.color)),null!=localStorage.getItem("sketchFlipSecond")){let e=Number(localStorage.getItem("sketchFlipSecond"));isNaN(e)||(this.sketchFlipSecond=e)}},beforeMount(){window.addEventListener("keyup",this.handleKeyup),"sketch"==this.nowTemplate&&this.startSketchMode()},beforeUnmount(){window.removeEventListener("keyup",this.handleKeyup)},mounted(){setTimeout(this.setNowPageNumByCookie,500)},updated(){},methods:{onBackgroundColorChange(e){let t=Number("0x"+e.substr(1,2)),o=Number("0x"+e.substr(3,2)),a=Number("0x"+e.substr(5,2)),s=t<215?t-40:t+parseInt((255-t)/2),l=o<225?o-30:o+parseInt((255-o)/2),i=a<213?a-42:a+parseInt((255-a)/2);t<50&&(s=t+120),o<50&&(l=o+90),a<50&&(i=a+126),this.model.colorHeader="#"+s.toString(16)+l.toString(16)+i.toString(16)},nowAndNextPageIsSingle(){return this.nowPageIsDouble=this.checkImageIsDoublePage_byPageNum(this.nowPageNum),this.nextPageIsDouble=this.checkImageIsDoublePage_byPageNum(this.nowPageNum+1),this.nowPageIsDouble||this.nextPageIsDouble?(this.nowAndNextPageIsSingleFlag=!1,!1):(this.nowAndNextPageIsSingleFlag=!1,!0)},setNowPageNumByCookie(){if(this.saveNowPageNumFlag_FlipMode){let e=localStorage.getItem("nowPageNum"+this.book.uuid);if(null!=e){let t=Number(e);isNaN(t)?console.log("读取页数失败，this.nowPageNum="+this.nowPageNum):this.nowPageNum=t}else console.log("cookie里面没找到:nowPageNum"+this.book.uuid)}},OnSetTemplate(e){"scroll"==e?console.log("跳转到卷轴阅读模式"):"scroll"==this.nowTemplate&&this.$router.push({name:"ScrollMode",params:{id:this.book.id}})},drawerActivate(e){this.drawerActive=!0,this.drawerPlacement=e},drawerDeactivate(){this.drawerActive=!1},startSketchMode(){this.message.success(this.$t("startSketchMessage")),this.drawerActive=!1,this.sketchModeFlag=!0,this.showPageHintFlag_FlipMode=!0,this.showHeaderFlag_FlipMode=!1,this.showFooterFlag_FlipMode=!1,this.interval=setInterval(this.sketchCount,1e3)},resetSketchSecondCount(){this.sketchSecondCount=0},stopSketchMode(){this.message.success(this.$t("goodjob_and_byebye")),this.sketchModeFlag=!1,this.showPageHintFlag_FlipMode=!1,this.sketchSecondCount=0,this.showHeaderFlag_FlipMode=!0,this.showFooterFlag_FlipMode=!0,clearInterval(this.interval)},sketchCount(){0!=this.sketchModeFlag&&"sketch"==this.nowTemplate||this.stopSketchMode(),this.sketchSecondCount=this.sketchSecondCount+1,0==this.sketchSecondCount%this.sketchFlipSecond&&(this.nowPageNum<this.book.all_page_num?this.flipPage(1):this.toPage(1))},saveConfigToCookie(){localStorage.setItem("debugModeFlag",this.debugModeFlag),localStorage.setItem("showHeaderFlag_FlipMode",this.showHeaderFlag_FlipMode),localStorage.setItem("showFooterFlag_FlipMode",this.showFooterFlag_FlipMode),localStorage.setItem("showPageHintFlag_FlipMode",this.showPageHintFlag_FlipMode),localStorage.setItem("rightToLeftFlag",this.rightToLeftFlag),localStorage.setItem("simpleDoublePageModeFlag",this.simpleDoublePageModeFlag),localStorage.setItem("autoDoublePageModeFlag",this.autoDoublePageModeFlag),localStorage.setItem("saveNowPageNumFlag_FlipMode",this.saveNowPageNumFlag_FlipMode),localStorage.setItem("nowPageNum"+this.book.uuid,this.nowPageNum),localStorage.setItem("FlipModeDefaultColor",this.model.color),localStorage.setItem("sketchFlipSecond",this.sketchFlipSecond)},randomBackgroundColor(){let e="rgb("+(Math.ceil(155*Math.random())+100)+","+(Math.ceil(155*Math.random())+100)+","+(Math.ceil(100*Math.random())+100)+")";this.model.color=e},onMouseOver(){},onMouseEnter(){},onMouseLeave(e){e.currentTarget.style.cursor=""},onMouseMove(e){let t=e.x,o=e.y,a=window.innerWidth,s=window.innerHeight;t>.4*a&&t<.6*a&&o>.4*s&&o<.6*s?e.currentTarget.style.cursor="url(/images/SettingsOutline.png), pointer":t<.5*a?this.rightToLeftFlag&&1==this.nowPageNum?e.currentTarget.style.cursor="url(/images/Prohibited28Filled.png), pointer":this.rightToLeftFlag||this.nowPageNum!=this.book.all_page_num?e.currentTarget.style.cursor="url(/images/ArrowLeft.png), pointer":e.currentTarget.style.cursor="url(/images/Prohibited28Filled.png), pointer":this.rightToLeftFlag&&this.nowPageNum==this.book.all_page_num?e.currentTarget.style.cursor="url(/images/Prohibited28Filled.png), pointer":this.rightToLeftFlag||1!=this.nowPageNum?e.currentTarget.style.cursor="url(/images/ArrowRight.png), pointer":e.currentTarget.style.cursor="url(/images/Prohibited28Filled.png), pointer"},onMouseClick(e){let t=e.x,o=e.y,a=window.innerHeight,s=window.innerWidth;t>.4*s&&t<.6*s&&o>.4*a&&o<.6*a?this.drawerActivate("right"):t<.5*s?1==this.rightToLeftFlag?this.toPerviousPage():this.toNextPage():1==this.rightToLeftFlag?this.toNextPage():this.toPerviousPage()},toNextPage(){if(this.simpleDoublePageModeFlag)return this.nowPageNum<this.book.all_page_num-1?void this.flipPage(2):void this.flipPage(1);this.autoDoublePageModeFlag&&this.checkMergedStatus_ByPageNum(this.nowPageNum)&&this.nowPageNum<this.book.all_page_num-1?this.flipPage(2):this.flipPage(1)},toPerviousPage(){if(this.nowPageNum<=1)return void console.log("Error toPerviousPage");if(this.simpleDoublePageModeFlag)return this.nowPageNum-2>0?void this.flipPage(-2):void this.flipPage(-1);if(2==this.nowPageNum||!this.autoDoublePageModeFlag)return void this.flipPage(-1);this.checkImageIsDoublePage_byPageNum(this.nowPageNum-1)||this.checkImageIsDoublePage_byPageNum(this.nowPageNum-2)?this.flipPage(-1):this.flipPage(-2)},checkMergedStatus_ByPageNum(e){if(!this.autoDoublePageModeFlag)return!1;if(e<=0||e>=this.book.all_page_num)return console.log("Error pageNum :"+e),!1;if(e==this.book.all_page_num)return!1;let t=this.checkImageIsDoublePage_byPageNum(e),o=this.checkImageIsDoublePage_byPageNum(e+1);return!(t||o)},checkImageIsDoublePage_byPageNum(e){if(e<=0||e>this.book.all_page_num)return void console.log("Error checkImageIsDoublePage_byPageNum:"+e);if("SinglePage"==this.book.pages[e-1].image_type)return!1;if("DoublePage"==this.book.pages[e-1].image_type)return!0;let t=new Image,o=!1;return t.src=this.book.pages[e-1].url,t.complete?t.width>=t.height:(t.onload=function(){t.width<t.height?(t.onload=null,o=!1):(t.onload=null,o=!0)},o)},flipPage:function(e){this.nowPageNum+e<=this.book.all_page_num&&this.nowPageNum+e>=1?this.nowPageNum=this.nowPageNum+e:e>0?this.message.info(this.$t("hintLastPage")):this.message.info(this.$t("hintFirstPage")),this.saveNowPageNumOnUpdate(this.nowPageNum)},saveNowPageNumOnUpdate(e){this.saveNowPageNumFlag_FlipMode&&localStorage.setItem("nowPageNum"+this.book.uuid,e)},toPage:function(e){e<=this.book.all_page_num&&e>=1&&(this.nowPageNum=e),this.saveNowPageNumFlag_FlipMode&&localStorage.setItem("nowPageNum"+this.book.uuid,this.nowPageNum)},handleKeyup(e){const t=e||window.event;if(t)switch(t.key){case"ArrowUp":case"PageUp":case"ArrowLeft":this.flipPage(-1);break;case"Space":case"ArrowDown":case"PageDown":case"ArrowRight":this.flipPage(1);break;case"Home":this.toPage(1);break;case"End":this.toPage(this.book.all_page_num)}},setShowHeaderChange(e){console.log("value:"+e),this.showHeaderFlag_FlipMode=e,localStorage.setItem("showHeaderFlag_FlipMode",e),console.log("cookie设置完毕: showHeaderFlag_FlipMode="+localStorage.getItem("showHeaderFlag_FlipMode"))},setShowFooterFlagChange(e){console.log("value:"+e),this.showFooterFlag_FlipMode=e,localStorage.setItem("showFooterFlag_FlipMode",e),console.log("cookie设置完毕: showFooterFlag_FlipMode="+localStorage.getItem("showFooterFlag_FlipMode"))},setShowPageNumChange(e){console.log("value:"+e),this.showPageHintFlag_FlipMode=e,localStorage.setItem("showPageHintFlag_FlipMode",e),console.log("cookie设置完毕: showPageHintFlag_FlipMode="+localStorage.getItem("showPageHintFlag_FlipMode"))},setFlipScreenFlag(e){console.log("value:"+e),this.rightToLeftFlag=e,localStorage.setItem("rightToLeftFlag",e),console.log("cookie设置完毕: rightToLeftFlag="+localStorage.getItem("rightToLeftFlag"))},setSavePageNumFlag(e){console.log("value:"+e),this.saveNowPageNumFlag_FlipMode=e,localStorage.setItem("saveNowPageNumFlag_FlipMode",e),console.log("cookie设置完毕: saveNowPageNumFlag_FlipMode="+localStorage.getItem("saveNowPageNumFlag_FlipMode"))},setDebugModeFlag(e){console.log("value:"+e),this.debugModeFlag=e,0==e&&(this.autoDoublePageModeFlag=!1),localStorage.setItem("debugModeFlag",e),console.log("cookie设置完毕: debugModeFlag="+localStorage.getItem("debugModeFlag"))},setAutoDoublePage_FlipMode(e){console.log("value:"+e),this.autoDoublePageModeFlag=e,1==e&&(this.simpleDoublePageModeFlag=!1),localStorage.setItem("autoDoublePageModeFlag",e),console.log("cookie设置完毕: autoDoublePageModeFlag="+localStorage.getItem("autoDoublePageModeFlag"))},setSimpleDoublePage_FlipMode(e){console.log("value:"+e),this.simpleDoublePageModeFlag=e,1==e&&(this.autoDoublePageModeFlag=!1),localStorage.setItem("simpleDoublePageModeFlag",e),console.log("cookie设置完毕: simpleDoublePageModeFlag="+localStorage.getItem("simpleDoublePageModeFlag"))}},computed:{pageNumOrSketchHint(){if(this.sketchModeFlag){let e=this.sketchSecondCount%this.sketchFlipSecond+1,t=parseInt(this.sketchSecondCount/this.sketchFlipSecond),o=parseInt((this.sketchSecondCount+1)/60),a="";a=0==parseInt(o/60)?o+this.$t("minute"):parseInt(o/60)+this.$t("hour")+o%60+this.$t("minute");let s=a+(this.sketchSecondCount+1)%60+this.$t("second");return this.$t("now_is")+e+this.$t("second")+"  "+this.$t("total_is")+t+this.$t("page")+"  "+this.$t("totalTime")+s+"  "+this.$t("interval")+this.sketchFlipSecond+this.$t("second")}return this.nowPageNum+"/"+this.book.all_page_num},mangaAreaHeight(){let e=95;return this.showFooterFlag_FlipMode&&this.showHeaderFlag_FlipMode&&(e=95),this.showFooterFlag_FlipMode&&!this.showHeaderFlag_FlipMode&&(e=95),!this.showFooterFlag_FlipMode&&this.showHeaderFlag_FlipMode&&(e=95),this.showFooterFlag_FlipMode||this.showHeaderFlag_FlipMode||(e=100),e+"vh"},mangaImageHeight(){let e=95;return this.showFooterFlag_FlipMode&&this.showHeaderFlag_FlipMode&&(e=95),this.showFooterFlag_FlipMode&&!this.showHeaderFlag_FlipMode&&(e=95),!this.showFooterFlag_FlipMode&&this.showHeaderFlag_FlipMode&&(e=95),this.showFooterFlag_FlipMode||this.showHeaderFlag_FlipMode||(e=100),this.showPageHintFlag_FlipMode&&("sketch"==this.nowTemplate?e-=6:e-=3),e+"vh"},sketchHintHeight(){return"sketch"==this.nowTemplate?"6vh":"3vh"},sketchHintFontSize(){return"sketch"==this.nowTemplate?"24px":"16px"},get_flex_direction(){return 1==this.rightToLeftFlag?"row":"row-reverse"}}}),$e=()=>{W((e=>({"0b7f4f78":e.model.color,"0740381e":e.model.colorHeader,df5bc064:e.mangaAreaHeight,"605cd7c8":e.get_flex_direction,"463e3de8":e.mangaImageHeight,cd50d198:e.sketchHintHeight,"277f5086":e.sketchHintFontSize})))},We=He.setup;He.setup=We?(e,t)=>($e(),We(e,t)):$e;const Le={class:"body"},ze={class:"manga_area_img_div"},Ae=["src","alt"],Be=["src","alt"],Re=["src","alt"],Ue={key:0,class:"sketch_hint"},Oe={key:1,class:"footer"},Xe={key:0},Ee={key:1};var je=oe(He,[["render",function(e,t,o,a,s,l){const c=i("settings-outline"),u=i("n-icon"),m=i("Header"),p=i("n-slider"),_=i("n-color-picker"),k=i("n-divider"),b=i("n-switch"),S=i("n-space"),v=i("n-input-number"),f=i("Drawer");return r(),w(z,null,[h("div",Le,[this.showHeaderFlag_FlipMode?(r(),n(m,{key:0,class:"header",bookIsFolder:e.book.IsFolder,bookName:e.book.name,showReturnIcon:!0},{default:g((()=>[d(u,{size:"40",onClick:t[0]||(t[0]=t=>e.drawerActivate("right"))},{default:g((()=>[d(c)])),_:1})])),_:1},8,["bookIsFolder","bookName"])):P("",!0),h("div",{class:"manga_area",id:"MangaMain",onClick:t[1]||(t[1]=E(((...t)=>e.onMouseClick&&e.onMouseClick(...t)),["stop"])),onMousemove:t[2]||(t[2]=E(((...t)=>e.onMouseMove&&e.onMouseMove(...t)),["stop"])),onMouseleave:t[3]||(t[3]=E(((...t)=>e.onMouseLeave&&e.onMouseLeave(...t)),["stop"]))},[h("div",ze,[h("img",{src:this.book.pages[e.nowPageNum-1].url,alt:e.nowPageNum},null,8,Ae),!this.autoDoublePageModeFlag&&this.simpleDoublePageModeFlag&&this.nowPageNum<this.book.all_page_num?(r(),w("img",{key:0,src:this.book.pages[e.nowPageNum].url,alt:e.nowPageNum+1},null,8,Be)):P("",!0),this.autoDoublePageModeFlag&&this.nowPageNum<this.book.all_page_num&&this.nowAndNextPageIsSingle()?(r(),w("img",{key:1,src:this.book.pages[e.nowPageNum].url,alt:e.nowPageNum+1},null,8,Re)):P("",!0)]),this.showPageHintFlag_FlipMode?(r(),w("div",Ue,F(e.pageNumOrSketchHint),1)):P("",!0)],32),this.showFooterFlag_FlipMode?(r(),w("div",Oe,[this.rightToLeftFlag?(r(),w("div",Xe,[h("span",null,F(this.nowPageNum),1),d(p,{value:e.nowPageNum,"onUpdate:value":[t[4]||(t[4]=t=>e.nowPageNum=t),this.saveNowPageNumOnUpdate],max:this.book.all_page_num,min:1,step:1,"format-tooltip":e=>`${e}`},null,8,["value","max","format-tooltip","onUpdate:value"]),h("span",null,F(this.book.all_page_num),1)])):P("",!0),this.rightToLeftFlag?P("",!0):(r(),w("div",Ee,[h("span",null,F(this.book.all_page_num),1),d(p,{reverse:"",value:e.nowPageNum,"onUpdate:value":[t[5]||(t[5]=t=>e.nowPageNum=t),this.saveNowPageNumOnUpdate],max:this.book.all_page_num,min:1,step:1,"format-tooltip":e=>`${e}`},null,8,["value","max","format-tooltip","onUpdate:value"]),h("span",null,F(this.nowPageNum),1)]))])):P("",!0)]),d(f,{initDrawerActive:this.drawerActive,initDrawerPlacement:this.drawerPlacement,onSaveConfig:this.saveConfigToCookie,onStartSketch:this.startSketchMode,onStopSketch:this.stopSketchMode,onCloseDrawer:this.drawerDeactivate,onSetRM:e.OnSetReaderMode,nowTemplate:this.nowTemplate},{default:g((()=>[h("span",null,F(e.$t("setBackColor")),1),d(_,{value:e.model.color,"onUpdate:value":[t[6]||(t[6]=t=>e.model.color=t),e.onBackgroundColorChange],modes:["rgb"],"show-alpha":!1},null,8,["value","onUpdate:value"]),d(k),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.showHeaderFlag_FlipMode,"onUpdate:value":[t[7]||(t[7]=e=>this.showHeaderFlag_FlipMode=e),e.setShowHeaderChange]},{checked:g((()=>[I(F(e.$t("showHeader")),1)])),unchecked:g((()=>[I(F(e.$t("showHeader")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.showFooterFlag_FlipMode,"onUpdate:value":[t[8]||(t[8]=e=>this.showFooterFlag_FlipMode=e),e.setShowFooterFlagChange]},{checked:g((()=>[I(F(e.$t("readingProgressBar")),1)])),unchecked:g((()=>[I(F(e.$t("readingProgressBar")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.showPageHintFlag_FlipMode,"onUpdate:value":[t[9]||(t[9]=e=>this.showPageHintFlag_FlipMode=e),e.setShowPageNumChange]},{checked:g((()=>[I(F(e.$t("showPageNum")),1)])),unchecked:g((()=>[I(F(e.$t("showPageNum")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(k),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.saveNowPageNumFlag_FlipMode,"onUpdate:value":[t[10]||(t[10]=e=>this.saveNowPageNumFlag_FlipMode=e),this.setSavePageNumFlag]},{checked:g((()=>[I(F(e.$t("savePageNum")),1)])),unchecked:g((()=>[I(F(e.$t("savePageNum")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.rightToLeftFlag,"onUpdate:value":[t[11]||(t[11]=e=>this.rightToLeftFlag=e),this.setFlipScreenFlag],"rail-style":e.railStyle},{checked:g((()=>[I(F(e.$t("rightScreenToNext")),1)])),unchecked:g((()=>[I(F(e.$t("leftScreenToNext")),1)])),_:1},8,["value","rail-style","onUpdate:value"])])),_:1}),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.simpleDoublePageModeFlag,"onUpdate:value":[t[12]||(t[12]=e=>this.simpleDoublePageModeFlag=e),this.setSimpleDoublePage_FlipMode]},{checked:g((()=>[I(F(e.$t("simpleDoublePage")),1)])),unchecked:g((()=>[I(F(e.$t("simpleDoublePage")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),d(k),d(S,null,{default:g((()=>[d(b,{size:"large",value:this.debugModeFlag,"onUpdate:value":[t[13]||(t[13]=e=>this.debugModeFlag=e),this.setDebugModeFlag]},{checked:g((()=>[I(F(e.$t("debugMode")),1)])),unchecked:g((()=>[I(F(e.$t("debugMode")),1)])),_:1},8,["value","onUpdate:value"])])),_:1}),this.debugModeFlag?(r(),n(S,{key:0},{default:g((()=>[d(b,{size:"large",value:this.autoDoublePageModeFlag,"onUpdate:value":[t[14]||(t[14]=e=>this.autoDoublePageModeFlag=e),this.setAutoDoublePage_FlipMode]},{checked:g((()=>[I(F(e.$t("autoDoublePage")),1)])),unchecked:g((()=>[I(F(e.$t("autoDoublePage")),1)])),_:1},8,["value","onUpdate:value"])])),_:1})):P("",!0),"sketch"==this.nowTemplate?(r(),n(k,{key:1})):P("",!0),"sketch"==this.nowTemplate?(r(),n(v,{key:2,size:"small","show-button":!1,value:this.sketchFlipSecond,"onUpdate:value":[t[15]||(t[15]=e=>this.sketchFlipSecond=e),this.resetSketchSecondCount],max:65535,min:1,"update-value-on-input":!1},{prefix:g((()=>[I(F(e.$t("pageTurningSeconds")),1)])),suffix:g((()=>[I(F(e.$t("second")),1)])),_:1},8,["value","onUpdate:value"])):P("",!0),"sketch"==this.nowTemplate?(r(),n(p,{key:3,value:this.sketchFlipSecond,"onUpdate:value":[t[16]||(t[16]=e=>this.sketchFlipSecond=e),this.resetSketchSecondCount],step:1,max:120,min:1,marks:e.marks,"format-tooltip":e=>`${e}s`},null,8,["value","marks","format-tooltip","onUpdate:value"])):P("",!0)])),_:1},8,["initDrawerActive","initDrawerPlacement","onSaveConfig","onStartSketch","onStopSketch","onCloseDrawer","onSetRM","nowTemplate"])],64)}],["__scopeId","data-v-68458c0f"]]);const Ge=e({name:"BookCover",props:["title","image_src","id","readerMode","showTitle","childBookNum"],components:{},setup(){const{cookies:e}=a();return{cookies:e}},computed:{shortTitle(){return this.title.length<=17?this.title:this.title.substr(0,17)+"…"}},data:()=>({resize_str:"&resize_width=256&resize_height=360&resize_cut=true"}),methods:{onBackTop(){this.$router.push("/")},getBackgroundImageStyle(){return"background-image: url("+this.getThumbnailsImageUrl()+");"},getThumbnailsImageUrl(){return"api"==this.image_src.split("/")[0]?this.image_src+"&resize_width=256&resize_height=360&resize_cut=true":this.image_src},getHref(){var e=document.location.toString().split("/");if("flip"==this.readerMode)var t=e[0]+"//"+e[2]+"/#f/"+this.id;return"scroll"==this.readerMode&&(t=e[0]+"//"+e[2]+"/#s/"+this.id),console.log(t),t}}}),Ye={key:0,class:"absolute inset-x-0 top-0 text-right"},Ve={class:"text-2xl text-yellow-500 font-extrabold text-shadow"},Ke={class:"absolute inset-x-0 bottom-0 h-1/4 bg-gray-200 bg-opacity-80 font-medium"},qe={class:"align-middle"};const Je=e({name:"BookShelf",props:["readMode"],emits:["setTemplate"],components:{Header:ce,Drawer:_e,BookCard:oe(Ge,[["render",function(e,t,o,a,s,l){return r(),w("div",{class:"relative w-32 h-44 mx-3 my-4 text-gray-800 dark:text-gray-300 rounded-xl shadow-xl .bg-top bg-cover",style:j(e.getBackgroundImageStyle())},[""!=this.childBookNum?(r(),w("div",Ye,[h("span",Ve,F(this.childBookNum),1)])):P("",!0),h("div",Ke,[h("span",qe,F(this.shortTitle),1)])],4)}]]),NGrid:G,NGridItem:Y,NIcon:u,SettingsOutline:x,NDivider:v,NColorPicker:O},setup(){const{cookies:e}=a();return{cookies:e,model:H({color:"#E0D9CD",colorHeader:"#d1c9c1"}),railStyle:({focused:e,checked:t})=>{const o={};return t?(o.background="#d03050",e&&(o.boxShadow="0 0 0 2px #d0305040")):(o.background="#2080f0",e&&(o.boxShadow="0 0 0 2px #2080f040")),o},marks:{30:"25%",50:"50%",75:"75%",95:"95%"}}},data:()=>({bookShelfTitle:"loading",headerShowReturnIcon:!1,bookCardShowTitle:!0,ReaderMode:"scroll",maxDepth:1,bookshelf:[{name:"loading",all_page_num:1,id:"12345",book_type:"dir",parent_folder:"",depth:1,pages:[{height:500,width:449,url:"/images/loading.jpg"}],cover:{filename:"loading.jpg",height:500,width:449,url:"/images/loading.jpg"}}],drawerActive:!1,drawerPlacement:"right",debugModeFlag:!0,showHeaderFlag:!0,syncScrollFlag:!1,clickX:0,clickY:0,isLandscapeMode:!0,isPortraitMode:!1,imageMaxWidth:10,aspectRatio:1.2,clientWidth:0,clientHeight:0}),created(){this.getBookShelfData(),this.setReaderMode(),this.$watch((()=>this.$route.params),(()=>{this.setReaderMode(),this.setBookShelfTitle(),this.getBookShelfData()})),"true"===localStorage.getItem("showHeaderFlag")?this.showHeaderFlag=!0:"false"===localStorage.getItem("showHeaderFlag")&&(this.showHeaderFlag=!1),null!=localStorage.getItem("BookShelfDefaultColor")&&(this.model.color=localStorage.getItem("BookShelfDefaultColor"))},beforeMount(){},mounted(){this.isLandscapeMode=this.inLandscapeModeCheck(),this.isPortraitMode=!this.inLandscapeModeCheck(),this.$nextTick((function(){}))},beforeUnmount(){},methods:{getBookShelfData(){this.$route.params.id?(this.getBooksGroupByBookID(this.$route.params.id),this.headerShowReturnIcon=!0):(this.initBookShelf(),this.headerShowReturnIcon=!1)},setReaderMode(){null!=localStorage.getItem("ReaderMode")&&(this.ReaderMode=localStorage.getItem("ReaderMode"))},initBookShelf(){$.get("getlist?max_depth=1").then((e=>this.bookshelf=e.data)).finally((()=>{this.setBookShelfTitle()}))},getBooksGroupByBookID(e){$.get("getlist?book_group_book_id="+e).then((e=>{null!=e.data[0].name&&(this.bookshelf=e.data)})).finally((()=>{this.setBookShelfTitle()}))},setBookShelfTitle(){null!=this.bookshelf[0].depth&&(this.max_depth=this.bookshelf[0].depth),this.$store.state.server_status.ServerName&&(document.title=this.$store.state.server_status.ServerName,this.bookShelfTitle=this.$store.state.server_status.ServerName),this.$route.params.id&&null!=this.bookshelf[0].parent_folder&&""!=this.bookshelf[0].parent_folder&&(console.log("this.bookshelf[0]:"+this.bookshelf[0].parent_folder),document.title=this.bookshelf[0].parent_folder,this.bookShelfTitle=this.bookshelf[0].parent_folder)},onOpenBook(e,t){console.log("onOpenBook  bookID："+e+" bookType："+t),"book_group"!=t?("flip"!=this.ReaderMode&&"sketch"!=this.ReaderMode||this.$router.push({name:"FlipMode",params:{id:e}}),"scroll"==this.ReaderMode&&this.$router.push({name:"ScrollMode",params:{id:e}})):this.$router.push({name:"ChildBookShelf",params:{id:e}})},openBookOnce(){console.log("this.bookshelf[0].id :"+this.bookshelf[0].id),"12345"!=this.bookshelf[0].id&&this.onOpenBook(this.bookshelf[0].id,this.bookshelf[0].book_type)},drawerActivate(e){this.drawerActive=!0,this.drawerPlacement=e},drawerDeactivate(){this.drawerActive=!1},startSketchMode(){},OnSetReaderMode(e){"scroll"!=e&&"scroll"!=e||(this.ReaderMode=e)},saveConfigToCookie(){localStorage.setItem("showHeaderFlag",this.showHeaderFlag),localStorage.setItem("BookShelfDefaultColor",this.model.color)},setShowHeaderChange(e){console.log("value:"+e),this.showHeaderFlag=e,localStorage.setItem("showHeaderFlag",e),console.log("cookie设置完毕: showHeaderFlag="+localStorage.getItem("showHeaderFlag"))},inLandscapeModeCheck(){return this.aspectRatio=window.innerWidth/window.innerHeight,this.aspectRatio>1}},computed:{}}),Qe=()=>{W((e=>({"72ae3372":e.model.colorHeader,"66b7531a":e.model.color})))},Ze=Je.setup;Je.setup=Ze?(e,t)=>(Qe(),Ze(e,t)):Qe;const et={id:"BookShelf"},tt={class:"shelf"},ot={class:"flex flex-row flex-wrap"};var at=oe(Je,[["render",function(e,t,o,a,s,l){const c=i("settings-outline"),u=i("n-icon"),m=i("Header"),p=i("BookCard"),_=i("n-color-picker"),k=i("n-divider"),b=i("Drawer");return r(),w("div",et,[this.showHeaderFlag?(r(),n(m,{key:0,class:"footer",bookIsFolder:!1,bookName:this.bookShelfTitle,showReturnIcon:this.headerShowReturnIcon,setDownLoadLink:!1},{default:g((()=>[d(u,{size:"40",onClick:t[0]||(t[0]=t=>e.drawerActivate("right"))},{default:g((()=>[d(c)])),_:1})])),_:1},8,["bookName","showReturnIcon"])):P("",!0),h("div",tt,[h("div",ot,[(r(!0),w(z,null,A(this.bookshelf,((t,o)=>(r(),n(p,{key:o,title:t.name,id:t.id,image_src:t.cover.url,ReaderMode:this.ReaderMode,showTitle:this.bookCardShowTitle,childBookNum:t.child_book_num?"x"+t.child_book_num:"",onClick:o=>e.onOpenBook(t.id,t.book_type)},null,8,["title","id","image_src","ReaderMode","showTitle","childBookNum","onClick"])))),128))])]),d(b,{initDrawerActive:this.drawerActive,initDrawerPlacement:this.drawerPlacement,onSaveConfig:this.saveConfigToCookie,onStartSketch:this.startSketchMode,onCloseDrawer:this.drawerDeactivate,onSetRM:this.OnSetReaderMode,ReaderMode:this.ReaderMode,sketching:!1},{default:g((()=>[h("span",null,F(e.$t("setBackColor")),1),d(_,{value:e.model.color,"onUpdate:value":t[1]||(t[1]=t=>e.model.color=t),modes:["rgb"],"show-alpha":!1},null,8,["value"]),d(k)])),_:1},8,["initDrawerActive","initDrawerPlacement","onSaveConfig","onStartSketch","onCloseDrawer","onSetRM","ReaderMode"])])}],["__scopeId","data-v-33af7aba"]]);const st=e({name:"404Page",components:{NButton:f,NResult:V},setup(){const{cookies:e}=a();return{cookies:e}},methods:{onBackTop(){this.$router.push("/")}}}),lt=I('回首页╮(￣▽￣")╭');const it=[{path:"/",component:at,name:"BookShelf"},{path:"/child_shelf/:id",component:at,name:"ChildBookShelf"},{path:"/scroll/:id",component:xe,name:"ScrollMode"},{path:"/flip/:id",component:je,name:"FlipMode"},{path:"/about",component:()=>{return e=()=>import("./About.66850c82.js"),(t=["assets/About.66850c82.js","assets/About.6f92323b.css","assets/vendor.d6b6e896.js"])&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in ie)return;ie[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((t,o)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>o(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())):e();var e,t},name:"About"},{path:"/:pathMatch(.*)*",name:"NotFound",component:oe(st,[["render",function(e,t,o,a,s,l){const h=i("n-button"),c=i("n-result");return r(),n(c,{status:"404",title:"404 资源不存在",description:"没找到你想要的东西"},{footer:g((()=>[d(h,{onClick:t[0]||(t[0]=t=>e.onBackTop())},{default:g((()=>[lt])),_:1})])),_:1})}],["__scopeId","data-v-2e48c3d8"]])}],rt=K({history:q(),routes:it}),nt=J({state:{count:0,todos:[{id:1,text:"...",done:!0},{id:2,text:"...",done:!1}],now_page:1,book:{name:"loading",all_page_num:1,pages:[{height:500,width:449,url:"/images/loading.jpg"}]},bookshelf:[{name:"loading",all_page_num:1,pages:[{height:500,width:449,url:"/images/loading.jpg"}]}],server_status:{template:"scroll",sketch_count_seconds:30},message:{user_id:"",server_status:"",now_book_id:"",read_percent:0,msg:""}},mutations:{increment(e){e.count++},syncSeverStatusData(e,t){e.server_status=t.message},syncBookData(e,t){e.book=t.message},syncBookShelfData(e,t){e.bookshelf=t.message}},actions:{incrementAction(e){e.commit("increment")},async syncSeverStatusDataAction(e){const t={message:await $.get("getstatus").then((e=>e.data),(()=>"")).finally((()=>{}))};e.commit("syncSeverStatusData",t),console.log("syncSeverStatusData!")},async syncBookDataAction(e){const t={message:await $.get("book.json").then((e=>e.data),(()=>""))};e.commit("syncBookData",t),console.log("syncBookData!")},async syncBookShelfDataAction(e){const t={message:await $.get("getshelf").then((e=>e.data),(()=>""))};e.commit("syncBookShelfData",t),console.log("syncBookShelfData!")}},getters:{doneTodos:e=>e.todos.filter((e=>e.done)),now_page:e=>e.now_page,book:e=>e.book,bookshelf:e=>e.bookshelf,setting:e=>e.setting,message:e=>e.message},modules:{}});const gt={en:{...{test:"test",debugMode:"Debug Mode",ReaderSettings:"Reader Settings",scroll_mode:"ScrollMode",flip_mode:"FlipMode",singlePageWidth:"singlePageWidth:",doublePageWidth:"doublePageWidth:",width_usePercent:"Width:Percent",width_useFixedValue:"Width:Fixed value",showHeader:"Header Shown",showPageNum:"show PageNumber",setBackColor:"Set Background Color:",readingProgressBar:"Reading Progress Bar",savePageNum:"Save Reading Progress",rightScreenToNext:"Right screen to next page",leftScreenToNext:"Left screen to next page",startSketchMode:"Start Sketch",stopSketchMode:"Stop Sketch",hintFirstPage:"Now is the first page, can not turn forward",hintLastPage:"Now is the last page, can not turn the page",now_is:"now: ",second:"second",minute:"minute",total_is:"total: ",interval:"interval: ",page:"page",totalTime:"Total time: ",hour:"hour",pageTurningSeconds:"interval: ",startSketchMessage:"The countdown begins, Have a nice day.",goodjob_and_byebye:"Goodjob,bye.",simpleDoublePage:"DoublePage",autoDoublePage:"DoublePage（beta）",gray_image:"gray image",image_width_limit:"Limit size (width)",auto_crop:"Auto white cut",max_width:"max width:",energy_threshold:"Energy Threshold:","back-to-top":"Back To Top",raw_resolution:"Raw Resolution",reset_all_settings:"Reset all settings",do_you_reset_all_settings:" Do you want to reset to the default settings?"}},zh:{...{test:"测试",debugMode:"Debug Mode",scroll_mode:"卷轴模式",flip_mode:"翻页模式",ReaderSettings:"阅读器设定",singlePageWidth:"单页漫画宽度:",doublePageWidth:"双开页漫画宽:",width_usePercent:"宽度:百分比%",width_useFixedValue:"宽度:固定值px",showHeader:"显示标题",showPageNum:"显示页数",setBackColor:"设定背景色:",readingProgressBar:"阅读进度条",savePageNum:"保存阅读进度",rightScreenToNext:"右半屏翻下一页",leftScreenToNext:"左半屏翻下一页",startSketchMode:"开始速写",stopSketchMode:"停止速写",hintFirstPage:"现在是第一页,无法向前翻页",hintLastPage:"现在是最后一页，无法往后翻页",now_is:"现在:",second:"秒",minute:"分",total_is:"完成:",interval:"翻页间隔:",page:"张",totalTime:"经过时间:",hour:"小时",pageTurningSeconds:"翻页间隔:",startSketchMessage:"开始倒计时速写，祝你心情愉快。",goodjob_and_byebye:"做得不错，再见~",simpleDoublePage:"合并双页",autoDoublePage:"合并双页（beta）",original_image:"显示原图",gray_image:"黑白化",image_width_limit:"限制尺寸(宽)",raw_resolution:"原始分辨率",auto_crop:"自动切边",max_width:"最大宽度：",energy_threshold:"切边强度：","back-to-top":"回到页首",reset_all_settings:"重置所有设定",do_you_reset_all_settings:"是否要重置为默认设定？"}},ja:{...{test:"test",debugMode:"Debug Mode",ReaderSettings:"リーダー設定",scroll_mode:"スクロール",flip_mode:"ページめくり",singlePageWidth:"1ページ漫画横幅:",doublePageWidth:"見開きページの幅:",width_usePercent:"横幅:パーセント",width_useFixedValue:"横幅:固定値",showHeader:"タイトル表示",showPageNum:"ページ数表示",setBackColor:"背景色を指定する:",readingProgressBar:"プログレスバー",savePageNum:"読書進捗の保存",rightScreenToNext:"右半分の画面で次ページ",leftScreenToNext:"左半分の画面で次ページ",startSketchMode:"クロッキー開始",stopSketchMode:"クロッキー終了",hintFirstPage:"最初のページで、進めることはできません",hintLastPage:"最後のページです",now_is:"今:",second:"秒",minute:"分",total_is:"合計:",interval:"間隔:",page:"ページ",totalTime:"合計時間:",hour:"時間",pageTurningSeconds:"ページをめくる秒数:",startSketchMessage:"クロッキーが始まりました、良い一日を。",goodjob_and_byebye:"お疲れ様でした、バイバイ。",simpleDoublePage:"ページ合併",autoDoublePage:"ページ合併（beta）",gray_image:"モノクロ化",image_width_limit:"サイズ（幅）を制限",auto_crop:"余白自動トリミング",max_width:"最大幅:",energy_threshold:"エネルギー閾値：","back-to-top":"ページのトップへ戻る",raw_resolution:"元の解像度",reset_all_settings:" 初期設定に戻す",do_you_reset_all_settings:"初期設定に戻すか？"}}},ht=new Q.exports.createI18n({locale:localStorage.getItem("lang")||"zh",globalInjection:!0,messages:gt});$.defaults.baseURL="/api";const dt=Z(le);dt.use(ht),dt.use(ee,$),dt.use(nt),dt.use(rt),dt.use(te,{preLoad:1.9,loading:"/images/loading.jpg",error:"/images/error.jpg",attempt:4,observerOptions:{rootMargin:"200px",threshold:.1},lifecycle:{loading:e=>{e.setAttribute("class","LoadingImage")},error:e=>{e.setAttribute("class","ErrorImage")},loaded:e=>{let t=new Image;t.src=e.src,t.complete?(e.setAttribute("w",t.width),e.setAttribute("h",t.height),t.width<t.height?e.setAttribute("class","SinglePageImage"):e.setAttribute("class","DoublePageImage")):e.setAttribute("class","SinglePageImage")}}}),dt.mount("#app");export{oe as _};
